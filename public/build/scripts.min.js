!function(){function a(){var b=Object.create(RegExp.prototype);return b=RegExp.apply(b,arguments)||b,a.injectClassMethods(b),b}function b(){return new a}var c=this;a.injectClassMethods=function(b){for(var c in a.prototype)a.prototype.hasOwnProperty(c)&&(b[c]=a.prototype[c]);return b},a.prototype={_prefixes:"",_source:"",_suffixes:"",_modifiers:"gm",sanitize:function(a){return a.source?a.source:a.replace(/[^\w]/g,function(a){return"\\"+a})},add:function(a){return this._source+=a||"",this.compile(this._prefixes+this._source+this._suffixes,this._modifiers),this},startOfLine:function(a){return a=0!=a,this._prefixes=a?"^":"",this.add(""),this},endOfLine:function(a){return a=0!=a,this._suffixes=a?"$":"",this.add(""),this},then:function(a){return a=this.sanitize(a),this.add("(?:"+a+")"),this},find:function(a){return this.then(a)},maybe:function(a){return a=this.sanitize(a),this.add("(?:"+a+")?"),this},anything:function(){return this.add("(?:.*)"),this},anythingBut:function(a){return a=this.sanitize(a),this.add("(?:[^"+a+"]*)"),this},something:function(){return this.add("(?:.+)"),this},somethingBut:function(a){return a=this.sanitize(a),this.add("(?:[^"+a+"]+)"),this},replace:function(a,b){return a=a.toString(),a.replace(this,b)},lineBreak:function(){return this.add("(?:(?:\\n)|(?:\\r\\n))"),this},br:function(){return this.lineBreak()},tab:function(){return this.add("\\t"),this},word:function(){return this.add("\\w+"),this},anyOf:function(a){return a=this.sanitize(a),this.add("["+a+"]"),this},any:function(a){return this.anyOf(a)},range:function(){for(var a="[",b=0;b<arguments.length;b+=2){var c=b+1;if(arguments.length<=e)break;var d=this.sanitize(arguments[b]),e=this.sanitize(arguments[c]);a+=d+"-"+e}return a+="]",this.add(a),this},addModifier:function(a){return-1==this._modifiers.indexOf(a)&&(this._modifiers+=a),this.add(""),this},removeModifier:function(a){return this._modifiers=this._modifiers.replace(a,""),this.add(""),this},withAnyCase:function(a){return 0!=a?this.addModifier("i"):this.removeModifier("i"),this.add(""),this},stopAtFirst:function(a){return 0!=a?this.removeModifier("g"):this.addModifier("g"),this.add(""),this},searchOneLine:function(a){return 0!=a?this.removeModifier("m"):this.addModifier("m"),this.add(""),this},multiple:function(a){switch(a=a.source?a.source:this.sanitize(a),a.substr(-1)){case"*":case"+":break;default:a+="+"}return this.add(a),this},or:function(a){return this._prefixes+="(?:",this._suffixes=")"+this._suffixes,this.add(")|(?:"),a&&this.then(a),this},beginCapture:function(){return this._suffixes+=")",this.add("(",!1),this},endCapture:function(){return this._suffixes=this._suffixes.substring(0,this._suffixes.length-1),this.add(")",!0),this}},"undefined"!=typeof module&&module.exports?module.exports=b:"function"==typeof define&&define.amd?define(a):c.VerEx=b}.call(),+function(a){"use strict";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.parent().find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:"hover"},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition.end&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide("next")},b.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},b.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;this.sliding=!0,f&&this.pause(),e=e.length?e:this.$element.find(".item")[h]();var j=a.Event("slide.bs.carousel",{relatedTarget:e[0],direction:g});if(!e.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(j),j.isDefaultPrevented())return;e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid")},0)}).emulateTransitionEnd(600)}else{if(this.$element.trigger(j),j.isDefaultPrevented())return;d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return f&&this.cycle(),this}};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("bs.carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data()),g=d.attr("data-slide-to");g&&(f.interval=!1),e.carousel(f),(g=d.attr("data-slide-to"))&&e.data("bs.carousel").to(g),b.preventDefault()}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var b=a(this);b.carousel(b.data())})})}(window.jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]}}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(window.jQuery);var canvas={update:!0,position:"front",details:[],visualDetails:[],noVisualDetails:[],load:function(){function a(){e.fadeOut(function(){$(".car").fadeIn(),canvas.init()})}function b(){e.text(Math.floor(100*c.progress)+"%")}for(var c=new createjs.LoadQueue(!0,"img/"),d=["stagefront.jpg","stageback.jpg","stagetop.jpg"],e=$(".preload"),f=d.length-1;f>=0;f--)c.loadFile(d[f]);c.addEventListener("complete",a),c.addEventListener("progress",b)},init:function(){var a=document.getElementById("canvas");this.stage=new createjs.Stage(a),createjs.Touch.enable(this.stage),this.stage.enableMouseOver(10),this.stage.mouseMoveOutside=!0,this.nav=$(".car li"),this.blockTweet=$(".car .tweet"),this.blockTweet.css("opacity","0"),this.car=$(".car"),this.imgNews=$("#img-news"),this.car.css("background-image","url(img/stagefront.jpg)"),this.newsTweet=$("#priz-tweet"),createjs.Ticker.addEventListener("tick",canvas.tick.bind(canvas)),$.post("/",function(a){canvas.details=a,canvas.sortDetail()}).done(function(){console.log("items loaded")}).fail(function(){console.log("items loaded error")})},sortDetail:function(){var a=this;this.details.forEach(function(b){"visual"===b.type?a.visualDetails.push(b):a.noVisualDetails.push(b)}),this.visual(),this.noVisual()},visual:function(){var a=this;this.stage.removeAllChildren(),this.visualDetails.forEach(function(b,c){a.renderVisual(b),a.visualDetails.length-1===c&&a.renderNews(b)})},noVisual:function(){this.noVisualDetails.forEach(function(){})},renderVisual:function(a){var b=new Image,c=a.name;("front"!==canvas.position||"v18"!==c&&"v17"!==c&&"v19"!==c&&"v20"!==c)&&("back"!==canvas.position||"v2"!==c&&"v11"!==c&&"v13"!==c&&"v16"!==c&&"v20"!==c)&&("top"!==canvas.position||"v17"!==c&&"20"!==c)&&(b.src="img/"+c+"-"+this.position+".png",b.onload=function(b){canvas.handleDetailLoad(b,a)})},renderNoVisual:function(){},handleDetailLoad:function(a,b){var c,d=a.target,e=new createjs.Container;this.update=!0,c=new createjs.Bitmap(d),c.x=0,c.y=0,c.cursor="pointer",e.addChild(c),this.stage.addChild(e),function(a,b){c.onMouseOver=function(a){canvas.showBlockTweet(b,a.stageX,a.stageY)},c.onMouseOut=function(){canvas.hideBlockTweet()}}(c,b),createjs.Ticker.addEventListener("tick",canvas.tick.bind(canvas))},showBlockTweet:function(a,b,c){var d=this.formatText(a.user.text);this.blockTweet.show().css("opacity","1"),this.blockTweet.find(".img").css("background-image","url("+a.user.avatar+")"),this.blockTweet.find(".name").text(a.user.name),this.blockTweet.find(".nick_name").text("@"+a.user.screen_name),this.blockTweet.find("p").html(d);var e,f,g=this.blockTweet.outerWidth(!0),h=this.blockTweet.outerHeight(!0);b-56+g>850?(e=b+56-g,this.blockTweet.addClass("right").removeClass("left")):(e=b-56,this.blockTweet.addClass("left").removeClass("right")),f=-50>c-h?c+50:c-h-20,this.blockTweet.css({left:e,top:f})},hideBlockTweet:function(){this.blockTweet.css("opacity",0).hide()},formatText:function(a){var b=a,c=VerEx().find("#").replace(b,"<span>#wottak</span> ");return c},renderNews:function(a){var b=a["news-text"]+" "+a.user.name+" награждается мини-призом.",c=this.formatText(a.user.text);$("#text-news").text(b),this.imgNews.is(":visible")||this.imgNews.show(),this.imgNews.attr("src","img/"+a.name+".png"),this.newsTweet.find(".img").css("background-image","url("+a.user.avatar+")"),this.newsTweet.find(".name").text(a.user.name),this.newsTweet.find(".nick_name").text("@"+a.user.screen_name),this.newsTweet.find("p").html(c)},tick:function(a){this.update&&(this.update=!1,this.stage.update(a))},next:function(){"front"===this.position?this.position="back":"back"===this.position?this.position="top":"top"===this.position&&(this.position="front"),this.renderStage()},prev:function(){"back"===this.position?this.position="front":"front"===this.position?this.position="top":"top"===this.position&&(this.position="back"),this.renderStage()},renderStage:function(a){a&&(this.position=a),this.stage.removeAllChildren(),this.nav.removeClass(),"front"===this.position?this.nav.eq(0).addClass("active"):"back"===this.position?this.nav.eq(1).addClass("active"):"top"===this.position&&this.nav.eq(2).addClass("active"),this.visual(),this.car.css("background-image","url(img/stage"+this.position+".jpg)")}};$(document).ready(function(){canvas.load()});var socket=io.connect(window.location.origin);socket.on("details",function(a){canvas.details=a,canvas.sortDetail()});